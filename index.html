<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>GM Barber - Reserva tu turno</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;500;700;900&display=swap" rel="stylesheet">
<link rel="icon" type="image/png" href="img/gmbarber.jpg">
<style>
  html { scroll-behavior: smooth; }

  .banner{
  width:100%;
  min-height:90vh;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  background:#fff;
  text-align:center;
  padding:20px;
}

.banner img{
  max-width:800px;
  width:100%;
  height:auto;
  margin-bottom:20px;
}

.banner-btn{
  display:inline-block;
  padding:14px 28px;
  border-radius:12px;
  background:var(--accent);
  color:#08101a;
  font-weight:700;
  text-decoration:none;
  transition:.2s;
}
.banner-btn:hover{
  background:#e5a60f;
  transform:scale(1.05);
}

  :root{
    --bg:#0b1220;
    --accent:#f6b21a;
    --muted:#6b7280;
    --card:#ffffff;
    --radius:14px;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    font-family:Inter,system-ui,Arial;
    background:linear-gradient(180deg,#0f1724 0%, #071024 100%);
    color:#0b1220;
  }
  .wrap{max-width:1100px;margin:40px auto;padding:24px;}
  .hero{
    display:flex;gap:28px;align-items:center;
    background:linear-gradient(90deg,#0b1220cc, #071024cc), 
                url("https://images.unsplash.com/photo-1621605813684-81e1b83a7fb0?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80") center/cover no-repeat;
    padding:28px;border-radius:16px;color:#fff;
    box-shadow:0 10px 30px rgba(2,6,23,0.6);
    animation: fadeIn 1s ease-in;
  }
  .logo img{width:84px;height:84px;border-radius:12px;object-fit:cover}
  .hero h1{margin:0;font-size:32px;font-weight:900}
  .hero p{margin:6px 0 0;color:rgba(255,255,255,0.9);font-size:17px}

  .grid{display:grid;grid-template-columns:1fr 420px;gap:24px;margin-top:20px}
  @media (max-width:900px){.grid{grid-template-columns:1fr}.hero{flex-direction:column;text-align:center}}

  .card{background:var(--card);border-radius:var(--radius);padding:20px;box-shadow:0 8px 30px rgba(2,6,23,0.08);}
  .section-title h2{margin:0;font-size:20px;font-weight:700;color:#0b1220}
  .desc{color:var(--muted);margin-bottom:8px}

  .services{display:flex;flex-wrap:wrap;gap:12px;margin-top:8px}
  .service{
    flex:1 1 45%;padding:14px;border-radius:12px;border:1px solid #eef2ff;background:#fff;
    text-align:center;font-weight:600;cursor:pointer;transition:.15s
  }
  .service:hover{transform:translateY(-4px);box-shadow:0 8px 20px rgba(11,18,32,0.12)}
  .service.selected{border-color:var(--accent);box-shadow:0 8px 30px rgba(246,178,26,0.18)}

  label{display:block;font-size:13px;color:#374151;margin:10px 0 6px}
  input,select{width:100%;padding:10px;border-radius:10px;border:1px solid #e6e7ee;font-size:14px}
  .times{display:flex;flex-wrap:wrap;gap:8px;margin-top:10px}
  .slot{padding:8px 12px;border-radius:10px;border:1px solid #e6e7ee;background:#fff;cursor:pointer;font-weight:600}
  .slot.off{background:#f3f4f6;color:#9ca3af;cursor:not-allowed}
  .slot.selected{background:var(--accent);color:#08101a}
  .btn{display:inline-block;width:100%;padding:12px;border-radius:12px;background:#08101a;color:#fff;font-weight:700;border:none;cursor:pointer;margin-top:12px;transition:.2s}
  .btn:hover{background:#111827;transform:scale(1.02)}

  .msg{padding:10px;border-radius:10px;margin-top:10px;font-weight:700;text-align:center;display:none}
  .msg.success{background:#ecfdf5;color:#065f46;border:1px solid #bbf7d0}
  .msg.error{background:#fff1f2;color:#7f1d1d;border:1px solid #fecaca}

  /* Mensaje Instagram destacado */
  .mensaje-instagram{
    padding:22px;border-radius:14px;
    background:#0d3d35;
    color:#fff;font-weight:600;
    text-align:center;margin-top:12px;
    box-shadow:0 6px 25px rgba(0,0,0,0.3);
    animation: fadeIn .8s ease;
  }
  .mensaje-instagram p{margin:10px 0;font-size:15px}
  .mensaje-instagram a{
    display:inline-block;
    margin-top:10px;
    background:#00ffaa;
    color:#000;
    font-weight:bold;
    padding:12px 28px;
    border-radius:10px;
    text-decoration:none;
    box-shadow:0 0 15px #00ffaa;
    transition:transform .2s;
  }
  .mensaje-instagram a:hover{transform:scale(1.05)}

  footer{margin-top:20px;text-align:center;color:#94a3b8;font-size:13px}
  footer a{color:var(--accent);font-weight:600;text-decoration:none}

  @keyframes fadeIn{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:none}}
</style>
</head>
<body>
  <!-- BANNER PRINCIPAL -->
<div class="banner">
  <img src="img/GM.png" alt="GM Barber Banner">
  <button id="goServices" class="banner-btn">Reservar ahora</button>
</div>

<div class="wrap">
  <div class="hero">
    <div class="logo"><img src="img/gmbarber.jpg" alt="GM Barber"></div>
    <div>
      <h1>GM Barber </h1>
      <p>Profesionalidad, estilo y puntualidad. Reserva f√°cil y r√°pida.</p>
    </div>
  </div>

  <div class="grid">
    <!-- SERVICIOS -->
    <div>
      <div class="card">
        <div class="section-title"><h2>Servicios ‚Äî Cortes</h2></div>
        <div class="services" id="services">
          <div class="service selected" data-service="Corte + afeitado de barba">Corte + afeitado de barba $9.000</div>
          <div class="service" data-service="Corte + perfilado de barba">Corte + perfilado de barba $9.000</div>
          <div class="service" data-service="Corte">Corte $8.000</div>
        </div>
        <hr>
        <div class="section-title"><h2>Servicios ‚Äî Color ‚ú®</h2></div>
        <p style="color:#92400e;font-weight:600;margin-bottom:8px">
          Servicios especiales, coordin√° tu turno directo por Instagram.
        </p>
        <div class="services">
          <div class="service" data-service="Global">Global<br><small>Desde $35.000</small></div>
          <div class="service" data-service="Reflejos">Reflejos<br><small>Desde $35.000</small></div>
          <div class="service" data-service="Franjas/Mechones">Franjas/Mechones<br><small>Desde $20.000</small></div>
        </div>
      </div>
    </div>

    <!-- RESERVAS -->
    <div>
      <div class="card" id="formulario-turno">
        <h3>Reservar turno</h3>
        <label>Fecha</label>
        <input type="date" id="date" min="">
        <label>Hora</label>
        <div class="times" id="times"></div>
        <label>Servicio</label>
        <select id="serviceSelect">
          <option value="Corte + afeitado de barba">Corte + afeitado de barba</option>
          <option value="Corte + perfilado de barba">Corte + perfilado de barba</option>
          <option value="Corte">Corte</option>
          <option value="Global + corte">Global + corte</option>
          <option value="Reflejos + corte">Reflejos + corte</option>
          <option value="Global">Global</option>
          <option value="Reflejos">Reflejos</option>
          <option value="Franjas/Mechones">Franjas/Mechones</option>
        </select>
        <label>Nombre</label>
        <input type="text" id="name" placeholder="Tu nombre">
        <label>Email</label>
        <input type="email" id="email" placeholder="tu@correo.com">
        <button id="bookBtn" class="btn">Confirmar reserva</button>
        <div id="message" class="msg"></div>
      </div>

      <!-- Bloque de Instagram -->
      <div id="color-reserva" style="display:none;">
        <div class="mensaje-instagram">
          <h3>‚ú® RESERV√Å TU TURNO ONLINE</h3>
          <p>Para coordinar d√≠a y horario de color hablame en Instagram</p>
          <a href="https://www.instagram.com/gmbarber_" target="_blank">Ir a Instagram</a>
        </div>
      </div>
    </div>
  </div>

  <footer>
    ¬© <span id="year"></span> GM Barber ‚Äî Reservas online<br>
    Libertad 4373, Lan√∫s Oeste<br>
    <a href="https://www.instagram.com/gmbarber_" target="_blank">@gmbarber_</a>
  </footer>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const dateInput = document.getElementById("date");
  const timesContainer = document.getElementById("times");
  const bookBtn = document.getElementById("bookBtn");
  const message = document.getElementById("message");
  const serviceSelect = document.getElementById("serviceSelect");
  const services = document.querySelectorAll(".service");

  const formularioTurno = document.getElementById("formulario-turno");
  const bloqueInstagram = document.getElementById("color-reserva");

  const serviciosColor = ["Global + corte","Reflejos + corte","Global","Reflejos","Franjas/Mechones"];

  const today = new Date();
  const yyyy = today.getFullYear();
  const mm = String(today.getMonth() + 1).padStart(2, "0");
  const dd = String(today.getDate()).padStart(2, "0");
  dateInput.min = `${yyyy}-${mm}-${dd}`;

  const horarios = {
    3: { start: "16:00", end: "19:00" }, 
    4: { start: "13:30", end: "15:30" }, 
    5: { start: "14:00", end: "19:00", ocupados: ["15:30","17:00","17:45"] },  // ‚≠ê fijos de s√°bado
    6: { start: "16:30", end: "20:00" }  
  };

  function loadOcupados(date) {
    return fetch(`https://script.google.com/macros/s/AKfycbzQocTERDGMMTBX_Y8jsNdlD2MuXPNYVb3FgGv2TZ2TYQg-nDYiDU_WvdNPhqjLDbSzDg/exec?date=${date}`)
      .then(res => res.json())
      .then(data => data.ocupados || [])
      .catch(err => {
        console.error("Error al cargar ocupados", err);
        return [];
      });
  }

  async function generateTimes(fecha) {
    timesContainer.innerHTML = "";
    if (!fecha) return;
    const [y, m, d] = fecha.split("-").map(Number);
    const selected = new Date(y, m - 1, d);
    const day = selected.getDay();
    const conf = horarios[day];
    if (!conf) {
      timesContainer.innerHTML = "<div class='muted'>No hay turnos disponibles</div>";
      return;
    }
    const { start, end } = conf;

    // üöÄ combinar ocupados fijos + servidor
    let ocupadosServidor = await loadOcupados(fecha);
    let ocupados = [];
    if (conf.ocupados) {
      ocupados = [...conf.ocupados, ...ocupadosServidor];
    } else {
      ocupados = ocupadosServidor;
    }

    const [sh, sm] = start.split(":").map(Number);
    const [eh, em] = end.split(":").map(Number);
    const startMin = sh * 60 + sm;
    const endMin = eh * 60 + em;
    const step = 45;
    for (let t = startMin; t <= endMin; t += step) {
      const h = String(Math.floor(t / 60)).padStart(2, "0");
      const mnn = String(t % 60).padStart(2, "0");
      const timeStr = `${h}:${mnn}`;
      const slot = document.createElement("div");
      slot.className = "slot";
      slot.textContent = timeStr;
      slot.dataset.time = timeStr;
      if (ocupados.includes(timeStr)) {
        slot.classList.add("off");
        slot.textContent = timeStr+" (Reservado)";
      } else {
        slot.addEventListener("click", () => {
          document.querySelectorAll(".slot").forEach(s => s.classList.remove("selected"));
          slot.classList.add("selected");
        });
      }
      timesContainer.appendChild(slot);
    }
  }

  function mostrarBloqueInstagram() {
    formularioTurno.style.display = "none";
    bloqueInstagram.style.display = "block";
  }

  function mostrarFormularioNormal() {
    formularioTurno.style.display = "block";
    bloqueInstagram.style.display = "none";
  }

  serviceSelect.addEventListener("change", () => {
    if (serviciosColor.includes(serviceSelect.value)) {
      mostrarBloqueInstagram();
    } else {
      mostrarFormularioNormal();
      if (dateInput.value) generateTimes(dateInput.value);
    }
  });

  dateInput.addEventListener("change", () => {
    if (!serviciosColor.includes(serviceSelect.value)) {
      generateTimes(dateInput.value);
    }
  });

  services.forEach(service => {
    service.addEventListener("click", () => {
      services.forEach(s => s.classList.remove("selected"));
      service.classList.add("selected");
      serviceSelect.value = service.dataset.service;
      if (serviciosColor.includes(serviceSelect.value)) {
        mostrarBloqueInstagram();
      } else {
        mostrarFormularioNormal();
        if (dateInput.value) generateTimes(dateInput.value);
      }
    });
  });

  bookBtn.addEventListener("click", () => {
    const name = document.getElementById("name").value.trim();
    const email = document.getElementById("email").value.trim();
    const date = dateInput.value;
    const timeEl = document.querySelector(".slot.selected");
    const service = serviceSelect.value;

    if (serviciosColor.includes(service)) {
      showMessage("‚ÑπÔ∏è Para servicios de color coordin√° por Instagram", "error");
      return;
    }
    if (!name || !email || !date || !timeEl) {
      showMessage("Por favor complet√° todos los campos.", "error");
      return;
    }
    showMessage("‚è≥ Guardando tu reserva...", "success");

    fetch("https://script.google.com/macros/s/AKfycbzQocTERDGMMTBX_Y8jsNdlD2MuXPNYVb3FgGv2TZ2TYQg-nDYiDU_WvdNPhqjLDbSzDg/exec", {
      method: "POST",
      body: JSON.stringify({
        name,
        email,
        date,
        time: timeEl.dataset.time,
        service
      }),
      headers: { "Content-Type": "text/plain;charset=utf-8" }
    })
    .then(res => res.json())
    .then(result => {
      if (result.status === "success") {
        showMessage("‚úÖ Reserva Confirmada", "success");

        // üîÑ Refrescar horarios con la respuesta del servidor
        if (result.ocupados) {
          generateTimes(date);
        }
      } else {
        showMessage("‚ùå " + result.message, "error");
      }
    })
    .catch(err => {
      console.error("‚ö†Ô∏è Error de conexi√≥n", err);
      showMessage("‚ö†Ô∏è Error de conexi√≥n con servidor", "error");
    });
  });

  function showMessage(text, type) {
    message.textContent = text;
    message.className = "msg " + type;
    message.style.display = "block";
    setTimeout(() => { message.style.display = "none"; }, 5000);
  }

  document.getElementById("year").textContent = new Date().getFullYear();
});
document.getElementById("goServices").addEventListener("click", () => {
  document.getElementById("services").scrollIntoView({ behavior: "smooth" });
});
</script>



</body>
</html>